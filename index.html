<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil do Usuário</title>
    <!-- Incluindo o Tailwind CSS para estilização rápida -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Usando a fonte Inter para um visual mais moderno */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilo customizado para o botão de perfil ativo na barra de navegação */
        .active-nav-item {
            background-color: #E6F7F0; /* Um verde bem claro */
            color: #00BFA5; /* Cor verde principal */
        }
        /* Esconde a scrollbar */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        
        /* Responsividade adicional */
        @media (min-width: 1024px) {
            body {
                background: linear-gradient(135deg, #f0f9ff 0%, #f8fafc 100%);
                padding: 1rem 0;
            }
        }
        
        @media (max-width: 640px) {
            /* Otimizações para mobile */
            .touch-optimization {
                min-height: 44px; /* iOS touch target minimum */
            }
        }
        
        /* Transições suaves para hover */
        .transition-colors {
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        }
        /* Estilos para transições suaves */
        .transition-all {
            transition: all 0.3s ease-in-out;
        }
        .medal-unlocked {
            border-color: #34D399; /* Verde para medalha desbloqueada */
            background-color: #F0FAF7;
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Container principal responsivo -->
    <div class="w-full max-w-sm mx-auto bg-white min-h-screen lg:max-w-md xl:max-w-lg lg:shadow-xl lg:rounded-2xl lg:mt-4 lg:mb-4 lg:min-h-[calc(100vh-2rem)] flex flex-col relative">

        <!-- TELA DE PERFIL -->
        <div id="profile-screen" class="flex flex-col flex-grow">
            <!-- Cabeçalho Superior -->
            <header class="bg-gradient-to-r from-purple-400 to-pink-400 p-4 sm:p-6">
                <div class="flex justify-between items-center">
                    <button class="text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <div class="flex flex-col items-center">
                        <div class="flex items-center space-x-2 mb-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M6 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                            </svg>
                            <h1 class="text-xl font-semibold text-white">clube Pagaleve</h1>
                        </div>
                        <div id="subscription-status" class="flex items-center space-x-1 text-white text-sm">
                            <span>Inativo</span>
                        </div>
                    </div>
                    <button class="text-white text-sm font-medium">
                        Ajuda
                    </button>
                </div>
            </header>

            <!-- Seção Economia Total -->
            <section class="px-4 sm:px-6 lg:px-8 py-4 sm:py-6 bg-white">
                <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
                    <div class="grid grid-cols-2 gap-4 mb-3">
                        <div>
                            <h2 class="text-sm text-gray-600 mb-1">Economia total</h2>
                            <p class="text-2xl font-bold text-gray-900">R$ 0,00</p>
                            <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mt-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-purple-500" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
                                </svg>
                            </div>
                        </div>
                        <div>
                            <h2 class="text-sm text-gray-600 mb-1">Cashback disponível</h2>
                            <p id="cashback-disponivel" class="text-2xl font-bold text-green-600">R$ 0,00</p>
                            <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mt-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01M12 6v-1h4v1m-4 0h-4v-1h4m0 10v1h4v-1m-4 0h-4v1h4" />
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div id="subscription-buttons-container">
                        <button id="subscription-action-btn" class="w-full bg-purple-500 text-white font-medium py-3 px-4 rounded-lg hover:bg-purple-600 transition-colors">
                            Assine seu plano
                        </button>
                    </div>
                </div>
            </section>

            <!-- Seção Cupons da Assinatura -->
            <section class="px-4 sm:px-6 lg:px-8 pb-4 sm:pb-6">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h3 id="cupons-section-title" class="text-lg font-semibold text-gray-900">Cupons</h3>
                        <p id="cupons-section-subtitle" class="text-sm text-gray-600" style="display: none;">2 para todos os restaurantes</p>
                    </div>
                    <button id="cupons-ver-detalhes-btn" class="text-red-500 text-sm font-medium">
                        Ver detalhes
                    </button>
                </div>
                
                <div class="flex space-x-3 overflow-x-auto pb-2">
                    <div class="flex-shrink-0 w-16 h-16 bg-purple-500 rounded-lg flex items-center justify-center transform rotate-12">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                        </svg>
                    </div>
                    <div class="flex-shrink-0 w-16 h-16 bg-purple-500 rounded-lg flex items-center justify-center transform -rotate-6">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                        </svg>
                    </div>
                    <div class="flex-shrink-0 w-16 h-16 bg-purple-500 rounded-lg flex items-center justify-center transform rotate-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                        </svg>
                    </div>
                    <div class="flex-shrink-0 w-16 h-16 bg-purple-500 rounded-lg flex items-center justify-center transform -rotate-12">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                        </svg>
                    </div>
                    <div class="flex-shrink-0 w-16 h-16 bg-purple-500 rounded-lg flex items-center justify-center transform rotate-6">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                        </svg>
                    </div>
                </div>
                
                <p id="cupons-restam-text" class="text-sm text-gray-600 mt-3" style="display: none;">
                    Restam <span class="font-semibold text-purple-600">2 de 2 cupons</span>
                </p>
            </section>


            <!-- Seção Ranking -->
            <section class="px-4 sm:px-6 lg:px-8 pb-4 sm:pb-6">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Ranking</h3>
                        <p class="text-sm text-gray-600">Veja sua posição no ranking</p>
                    </div>
                    <button id="ranking-ver-detalhes-btn" class="text-red-500 text-sm font-medium">
                        Ver ranking
                    </button>
                </div>
                
                <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-lg p-4 text-white">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <span id="ranking-position" class="text-lg font-bold text-white">1°</span>
                            </div>
                            <div>
                                <p class="font-semibold">Sua posição</p>
                                <p class="text-sm opacity-90">João (Você)</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p id="ranking-missions" class="text-lg font-bold">115</p>
                            <p class="text-xs opacity-90">missões</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Seção Conquistas -->
            <section class="px-4 sm:px-6 lg:px-8 pb-4 sm:pb-6">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Conquistas</h3>
                        <p class="text-sm text-gray-600">Suas medalhas e conquistas</p>
                    </div>
                    <button id="conquistas-ver-detalhes-btn" class="text-red-500 text-sm font-medium">
                        Ver todas
                    </button>
                </div>
                
                <div class="flex space-x-3 overflow-x-auto pb-2">
                    <div class="flex-shrink-0 w-16 h-16 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center border-4 border-yellow-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
                        </svg>
                    </div>
                    <div class="flex-shrink-0 w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center border-4 border-blue-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <div class="flex-shrink-0 w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center border-4 border-green-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    </div>
                    <div class="flex-shrink-0 w-16 h-16 bg-gray-300 rounded-full flex items-center justify-center border-4 border-gray-400 opacity-50">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                    </div>
                </div>
                
                <p class="text-sm text-gray-600 mt-3">
                    <span class="font-semibold text-green-600">3 conquistadas</span> de 4 medalhas disponíveis
                </p>
            </section>

            <!-- Seção de Saudação -->
            <section class="px-4 sm:px-6 lg:px-8 pb-4 sm:pb-6" style="display: none;">
                <div class="text-center">
                    <h2 class="text-lg sm:text-xl lg:text-2xl font-medium text-gray-700 mb-3">Olá, João</h2>
                    <div id="cashback-balance" class="inline-flex items-center space-x-2 bg-gray-50 px-3 sm:px-4 py-2 rounded-full text-sm sm:text-base">
                        <!-- Será preenchido pelo JavaScript -->
                    </div>
                </div>
            </section>


            <!-- Conteúdo Principal (Lista de Opções) -->
            <main class="flex-grow px-4 sm:px-6 lg:px-8 py-4 space-y-6 sm:space-y-8 overflow-y-auto no-scrollbar">
                <div class="space-y-3 sm:space-y-4">
                    <ul class="text-gray-700 space-y-1 sm:space-y-2">
                        <li class="flex items-center justify-between p-3 sm:p-4 lg:p-5 rounded-lg opacity-50 cursor-not-allowed" style="display: none;"><div class="flex items-center space-x-3 sm:space-x-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg><span class="font-medium text-gray-400 text-sm sm:text-base">Minhas compras</span></div><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-300" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></li>
                        <li id="simular-compra-btn" class="flex items-center justify-between p-3 sm:p-4 lg:p-5 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors" style="display: none;"><div class="flex items-center space-x-3 sm:space-x-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg><span class="font-medium text-sm sm:text-base">Simular Compra</span></div><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></li>
                        <li id="clube-beneficios-btn" class="flex items-center justify-between p-3 sm:p-4 lg:p-5 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors" style="display: none;"><div class="flex items-center space-x-3 sm:space-x-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" /></svg><span class="font-medium text-sm sm:text-base">Clube de Benefícios</span></div><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></li>
                        <li id="cupons-btn" class="flex items-center justify-between p-3 sm:p-4 lg:p-5 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors" style="display: none;"><div class="flex items-center space-x-3 sm:space-x-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" /></svg><span class="font-medium text-sm sm:text-base">Cupons</span></div><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></li>
                        <li id="show-achievements-btn" class="flex items-center justify-between p-3 sm:p-4 lg:p-5 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors" style="display: none;"><div class="flex items-center space-x-3 sm:space-x-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.196-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" /></svg><span class="font-medium text-sm sm:text-base">Conquistas</span></div><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></li>
                        <li id="show-ranking-btn" class="flex items-center justify-between p-3 sm:p-4 lg:p-5 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors" style="display: none;"><div class="flex items-center space-x-3 sm:space-x-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg><span class="font-medium text-sm sm:text-base">Ranking</span></div><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></li>
                        <li class="flex items-center justify-between p-3 sm:p-4 lg:p-5 rounded-lg opacity-50 cursor-not-allowed" style="display: none;"><div class="flex items-center space-x-3 sm:space-x-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4z" /></svg><span class="font-medium text-gray-400 text-sm sm:text-base">Dados pessoais</span></div><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-300" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></li>
                        <li class="flex items-center justify-between p-3 sm:p-4 lg:p-5 rounded-lg opacity-50 cursor-not-allowed" style="display: none;"><div class="flex items-center space-x-3 sm:space-x-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg><span class="font-medium text-gray-400 text-sm sm:text-base">Meus interesses</span></div><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-300" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></li>
                        <li class="flex items-center justify-between p-3 sm:p-4 lg:p-5 rounded-lg opacity-50 cursor-not-allowed" style="display: none;"><div class="flex items-center space-x-3 sm:space-x-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg><span class="font-medium text-gray-400 text-sm sm:text-base">Preferências</span></div><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-300" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></li>
                        <li class="flex items-center justify-between p-3 sm:p-4 lg:p-5 rounded-lg opacity-50 cursor-not-allowed" style="display: none;"><div class="flex items-center space-x-3 sm:space-x-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" /></svg><span class="font-medium text-gray-400 text-sm sm:text-base">Indique amigos</span></div><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-300" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></li>
                    </ul>
                </div>
            </main>
        </div>

        <!-- TELA DE CLUBE DE BENEFÍCIOS (escondida por padrão) -->
        <div id="benefits-screen" class="hidden flex-col flex-grow">
            <header class="p-4 flex justify-between items-center border-b border-gray-200">
                <button id="back-to-profile-from-benefits-btn" class="text-gray-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg></button>
                <div class="flex items-center space-x-2">
                    <img src="assets/logo.png" alt="Pagaleve" class="h-6 w-6">
                    <h1 class="text-xl font-semibold text-gray-800">clube Pagaleve</h1>
                </div>
                <div class="w-6 h-6"></div>
            </header>

            <main class="flex-grow p-4 bg-gray-50 overflow-y-auto no-scrollbar">
                <!-- Banner principal -->
                <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl p-6 mb-6 text-white">
                    <div class="flex items-center justify-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-center mb-2">Clube de Benefícios</h2>
                    <p class="text-center text-purple-100">Desbloqueie vantagens exclusivas para você!</p>
                </div>

                <!-- Benefícios -->
                <div class="space-y-4 mb-8">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Seus benefícios incluem:</h3>
                    
                    <!-- Benefício 1: Cashback -->
                    <div class="bg-white p-4 rounded-xl border border-gray-200 flex items-center space-x-4">
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01M12 6v-1h4v1m-4 0h-4v-1h4m0 10v1h4v-1m-4 0h-4v1h4" />
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800">1% de Cashback</h4>
                            <p class="text-sm text-gray-600">Ganhe 1% de volta em todas as suas compras</p>
                        </div>
                    </div>

                    <!-- Benefício 2: Taxa reduzida -->
                    <div class="bg-white p-4 rounded-xl border border-gray-200 flex items-center space-x-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" />
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800">20% de Desconto na Taxa</h4>
                            <p class="text-sm text-gray-600">Diminuição de 20% na taxa de serviço</p>
                        </div>
                    </div>

                    <!-- Benefício 3: Cupons -->
                    <div class="bg-white p-4 rounded-xl border border-gray-200 flex items-center space-x-4">
                        <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800">2 Cupons de R$ 10</h4>
                            <p class="text-sm text-gray-600">Para compras acima de R$ 200</p>
                        </div>
                    </div>
                </div>

                <!-- Botão de assinatura -->
                <div class="text-center">
                    <button id="subscribe-btn" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-4 px-6 rounded-xl transition-all text-lg shadow-lg">
                        Assinar Agora
                    </button>
                    <p class="text-sm text-gray-500 mt-2">Comece a aproveitar todos os benefícios hoje!</p>
                </div>
            </main>
        </div>

        <!-- TELA DE ASSINATURA ATIVA (escondida por padrão) -->
        <div id="active-subscription-screen" class="hidden flex-col flex-grow">
            <header class="p-4 flex justify-between items-center border-b border-gray-200">
                <button id="back-to-profile-from-active-btn" class="text-gray-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg></button>
                <h1 class="text-xl font-semibold text-gray-800">Minha Assinatura</h1>
                <div class="w-6 h-6"></div>
            </header>

            <main class="flex-grow p-4 bg-gray-50 overflow-y-auto no-scrollbar">
                <!-- Status da assinatura -->
                <div class="bg-gradient-to-r from-green-500 to-emerald-500 rounded-xl p-6 mb-6 text-white">
                    <div class="flex items-center justify-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-center mb-2">Assinatura Ativa</h2>
                    <p class="text-center text-green-100">Você está aproveitando todos os benefícios!</p>
                </div>

                <!-- Informações do plano -->
                <div class="bg-white p-4 rounded-xl border border-gray-200 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Detalhes do Plano</h3>
                    <div id="subscription-details" class="space-y-3">
                        <!-- Será preenchido pelo JavaScript -->
                    </div>
                </div>

                <!-- Benefícios ativos -->
                <div class="bg-white p-4 rounded-xl border border-gray-200 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Seus Benefícios Ativos</h3>
                    <div class="space-y-4">
                        <!-- Benefício 1: Cashback -->
                        <div class="flex items-center space-x-4 p-3 bg-green-50 rounded-lg border border-green-200">
                            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-800">1% de Cashback</h4>
                                <p class="text-sm text-gray-600">Ativo em todas as suas compras</p>
                            </div>
                            <span class="text-green-600 font-semibold text-sm">ATIVO</span>
                        </div>

                        <!-- Benefício 2: Taxa reduzida -->
                        <div class="flex items-center space-x-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-800">20% de Desconto na Taxa</h4>
                                <p class="text-sm text-gray-600">Aplicado automaticamente</p>
                            </div>
                            <span class="text-blue-600 font-semibold text-sm">ATIVO</span>
                        </div>

                        <!-- Benefício 3: Cupons -->
                        <div class="flex items-center space-x-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                            <div class="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-800">2 Cupons de R$ 10</h4>
                                <p class="text-sm text-gray-600">Para compras acima de R$ 200</p>
                            </div>
                            <span class="text-yellow-600 font-semibold text-sm">DISPONÍVEL</span>
                        </div>
                    </div>
                </div>

                <!-- Botão de ação -->
                <div>
                    <button id="cancel-subscription-btn" class="w-full bg-white border-2 border-red-200 hover:border-red-300 text-red-600 hover:text-red-700 font-bold py-3 px-6 rounded-xl transition-all">
                        Cancelar Assinatura
                    </button>
                </div>
            </main>
        </div>

        <!-- TELA DE SELEÇÃO DE PLANOS (escondida por padrão) -->
        <div id="plans-screen" class="hidden flex-col flex-grow">
            <header class="p-4 flex justify-between items-center border-b border-gray-200">
                <button id="back-to-benefits-btn" class="text-gray-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg></button>
                <h1 class="text-xl font-semibold text-gray-800">Escolha seu Plano</h1>
                <div class="w-6 h-6"></div>
            </header>

            <main class="flex-grow p-4 bg-gray-50 overflow-y-auto no-scrollbar">
                <div class="mb-6 text-center">
                    <h2 class="text-lg font-semibold text-gray-800 mb-2">Selecione o plano ideal para você</h2>
                    <p class="text-sm text-gray-600">Quanto mais tempo, maior a economia!</p>
                </div>

                <div class="space-y-4 mb-8">
                    <!-- Plano 1 mês -->
                    <div class="plan-option bg-white p-4 rounded-xl border-2 border-gray-200 cursor-pointer transition-all hover:border-purple-300" data-plan="1" data-price="20" data-total="20">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800">Plano Mensal</h3>
                                <p class="text-sm text-gray-600">1 mês de benefícios</p>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-purple-600">R$ 20</div>
                                <div class="text-sm text-gray-500">por mês</div>
                            </div>
                        </div>
                    </div>

                    <!-- Plano 3 meses -->
                    <div class="plan-option bg-white p-4 rounded-xl border-2 border-gray-200 cursor-pointer transition-all hover:border-purple-300 relative" data-plan="3" data-price="55" data-total="60">
                        <div class="absolute -top-2 -right-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full">
                            ECONOMIZE R$ 5
                        </div>
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800">Plano Trimestral</h3>
                                <p class="text-sm text-gray-600">3 meses de benefícios</p>
                                <p class="text-xs text-green-600 font-medium">Economia de R$ 5,00</p>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-gray-400 line-through">R$ 60</div>
                                <div class="text-2xl font-bold text-purple-600">R$ 55</div>
                                <div class="text-sm text-gray-500">R$ 18,33/mês</div>
                            </div>
                        </div>
                    </div>

                    <!-- Plano 6 meses -->
                    <div class="plan-option bg-white p-4 rounded-xl border-2 border-gray-200 cursor-pointer transition-all hover:border-purple-300 relative" data-plan="6" data-price="100" data-total="120">
                        <div class="absolute -top-2 -right-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full">
                            ECONOMIZE R$ 20
                        </div>
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800">Plano Semestral</h3>
                                <p class="text-sm text-gray-600">6 meses de benefícios</p>
                                <p class="text-xs text-green-600 font-medium">Economia de R$ 20,00</p>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-gray-400 line-through">R$ 120</div>
                                <div class="text-2xl font-bold text-purple-600">R$ 100</div>
                                <div class="text-sm text-gray-500">R$ 16,67/mês</div>
                            </div>
                        </div>
                    </div>
                </div>

                <button id="continue-to-payment-btn" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-4 px-6 rounded-xl transition-all text-lg shadow-lg opacity-50 cursor-not-allowed" disabled>
                    Continuar para Pagamento
                </button>
            </main>
        </div>

        <!-- TELA DE PAGAMENTO (escondida por padrão) -->
        <div id="payment-screen" class="hidden flex-col flex-grow">
            <header class="p-4 flex justify-between items-center border-b border-gray-200">
                <button id="back-to-plans-btn" class="text-gray-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg></button>
                <h1 class="text-xl font-semibold text-gray-800">Pagamento</h1>
                <div class="w-6 h-6"></div>
            </header>

            <main class="flex-grow p-4 bg-gray-50 overflow-y-auto no-scrollbar">
                <!-- Resumo do plano selecionado -->
                <div class="bg-white p-4 rounded-xl border border-gray-200 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Resumo do Pedido</h3>
                    <div id="selected-plan-summary" class="space-y-2">
                        <!-- Será preenchido pelo JavaScript -->
                    </div>
                </div>

                <!-- QR Code para pagamento -->
                <div class="bg-white p-6 rounded-xl border border-gray-200 text-center mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Escaneie o QR Code para pagar</h3>
                    <div class="flex justify-center mb-4">
                        <img src="assets/qrcode.png" alt="QR Code PIX" class="w-48 h-48 rounded-lg border border-gray-200">
                    </div>
                    <p class="text-sm text-gray-600 mb-4">Use o app do seu banco ou carteira digital</p>
                    <div class="text-center">
                        <div id="payment-total" class="text-2xl font-bold text-purple-600 mb-2">R$ 0,00</div>
                        <p class="text-sm text-gray-500">Valor total</p>
                    </div>
                </div>

                <button id="simulate-payment-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-xl transition-all text-lg shadow-lg">
                    Pagar Agora (Simulação)
                </button>
            </main>
        </div>

        <!-- TELA DE SIMULAÇÃO DE COMPRA (escondida por padrão) -->
        <div id="purchase-simulation-screen" class="hidden flex-col flex-grow">
            <header class="p-4 flex justify-between items-center border-b border-gray-200">
                <button id="back-to-profile-from-purchase-btn" class="text-gray-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg></button>
                <h1 class="text-xl font-semibold text-gray-800">Simular Compra</h1>
                <div class="w-6 h-6"></div>
            </header>

            <main class="flex-grow p-4 bg-gray-50 overflow-y-auto no-scrollbar">
                <!-- Produto -->
                <div class="bg-white rounded-xl border border-gray-200 mb-4">
                    <div class="p-4">
                        <div class="flex items-start space-x-4">
                            <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-black" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 mb-1">Smartphone XYZ</h3>
                                <p class="text-lg text-gray-800 mb-2">R$ 1.000,00</p>
                                <div id="cashback-info" class="flex items-center space-x-2 text-sm">
                                    <!-- Será preenchido pelo JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Parcelamento -->
                <div class="bg-white rounded-xl border border-gray-200 mb-6">
                    <div class="p-4">
                        <div class="flex items-start space-x-4 mb-4">
                            <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-black" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.42 0 2.13.54 2.39 1.4.12.4.45.7.87.7h.3c.66 0 1.13-.65.9-1.27-.42-1.18-1.4-2.16-2.96-2.54V4.5c0-.83-.67-1.5-1.5-1.5S10 3.67 10 4.5v.66c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-1.65 0-2.5-.59-2.83-1.43-.15-.39-.49-.67-.9-.67h-.28c-.67 0-1.14.68-.89 1.3.57 1.39 1.9 2.21 3.4 2.53v.67c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5v-.65c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z" />
                                </svg>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 mb-1">4 parcelas quinzenais</h3>
                                <p class="text-gray-600">Confira o valor das parcelas</p>
                            </div>
                        </div>

                        <!-- Detalhes do parcelamento -->
                        <div class="space-y-4">
                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-3 bg-green-50 border border-green-200 rounded-lg">
                                    <div>
                                        <span class="font-semibold text-gray-800">HOJE</span>
                                        <div class="text-sm text-gray-600">Taxa: R$ 20,00</div>
                                    </div>
                                    <span class="font-semibold text-gray-800">R$ 270,00</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 border border-gray-200 rounded-lg">
                                    <span class="text-gray-800">21/08/2025</span>
                                    <span class="text-gray-800">R$ 250,00</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 border border-gray-200 rounded-lg">
                                    <span class="text-gray-800">05/09/2025</span>
                                    <span class="text-gray-800">R$ 250,00</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 border border-gray-200 rounded-lg">
                                    <span class="text-gray-800">22/09/2025</span>
                                    <span class="text-gray-800">R$ 250,00</span>
                                </div>
                            </div>

                            <!-- Economia com Clube de Benefícios -->
                            <div id="service-fee-savings" class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                <!-- Será preenchido pelo JavaScript -->
                            </div>

                            <!-- Total -->
                            <div class="border-t pt-4 mt-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-lg font-bold text-gray-800">TOTAL</span>
                                    <span class="text-lg font-bold text-gray-800">R$ 1.020,00</span>
                                </div>
                                <div id="total-savings" class="text-sm text-gray-600 text-right mt-1">
                                    <!-- Será preenchido pelo JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botão de ação baseado no status da assinatura -->
                <div id="purchase-action-section">
                    <!-- Será preenchido pelo JavaScript -->
                </div>
            </main>
        </div>

        <!-- TELA DE RANKING (escondida por padrão) -->
        <div id="ranking-screen" class="hidden flex-col flex-grow">
            <header class="p-4 flex justify-between items-center border-b border-gray-200">
                <button id="back-to-profile-from-ranking-btn" class="text-gray-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg></button>
                <h1 class="text-xl font-semibold text-gray-800">Ranking</h1>
                <div class="w-6 h-6"></div>
            </header>

            <main class="flex-grow p-4 bg-gray-50 overflow-y-auto no-scrollbar">
                <!-- Pódio -->
                <div class="mb-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 text-center">🏆 Top 3</h2>
                    <div id="podium-container" class="flex justify-center items-end space-x-4 mb-6">
                        <!-- Será preenchido dinamicamente pelo JavaScript -->
                    </div>
                </div>

                <!-- Prêmios -->
                <div class="bg-white rounded-xl border border-gray-100 p-5 mb-6">
                    <div class="text-center mb-4">
                        <h2 class="text-lg font-semibold text-gray-800 mb-1">🏆 Prêmios do Ranking</h2>
                        <div class="w-12 h-0.5 bg-gradient-to-r from-green-400 to-pink-400 mx-auto"></div>
                    </div>
                    <div class="space-y-3">
                        <div class="flex items-center space-x-3 bg-green-50 border border-green-100 rounded-lg p-3">
                            <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center">
                                <span class="text-yellow-600 font-bold text-sm">1º</span>
                            </div>
                            <div class="flex items-center space-x-3 flex-1">
                                <span class="text-xl">📱</span>
                                <div>
                                    <p class="font-semibold text-gray-800">iPhone 15 Pro</p>
                                    <p class="text-sm text-gray-500">Primeiro lugar</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3 bg-pink-50 border border-pink-100 rounded-lg p-3">
                            <div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center">
                                <span class="text-gray-600 font-bold text-sm">2º</span>
                            </div>
                            <div class="flex items-center space-x-3 flex-1">
                                <span class="text-xl">🎁</span>
                                <div>
                                    <p class="font-semibold text-gray-800">Cupom de R$ 500</p>
                                    <p class="text-sm text-gray-500">Segundo lugar</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3 bg-green-50 border border-green-100 rounded-lg p-3">
                            <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center">
                                <span class="text-orange-600 font-bold text-sm">3º</span>
                            </div>
                            <div class="flex items-center space-x-3 flex-1">
                                <span class="text-xl">🎫</span>
                                <div>
                                    <p class="font-semibold text-gray-800">3 meses grátis do Clube</p>
                                    <p class="text-sm text-gray-500">Terceiro lugar</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
          
                <!-- Sua Posição -->
                <div class="bg-white rounded-xl border border-gray-200 mb-6">
                    <div class="p-4 border-b border-gray-100">
                        <h3 class="font-semibold text-gray-800">Sua Posição</h3>
                    </div>
                    <div id="user-position" class="p-4 bg-blue-50 border-l-4 border-blue-500">
                        <!-- Será preenchido pelo JavaScript -->
                    </div>
                </div>
                
                <!-- Lista completa do ranking -->
                <div class="bg-white rounded-xl border border-gray-200 mb-6">
                    <div class="p-4 border-b border-gray-100">
                        <h3 class="font-semibold text-gray-800">Ranking Completo</h3>
                    </div>
                    <div id="ranking-list" class="divide-y divide-gray-100">
                        <!-- Será preenchido pelo JavaScript -->
                    </div>
                </div>

                <!-- Botão de simulação -->
                <div class="text-center">
                    <button id="complete-mission-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl transition-all">
                        🎯 Simular Missão Completada
                    </button>
                    <p class="text-sm text-gray-500 mt-2">Complete missões para subir no ranking!</p>
                </div>
            </main>
        </div>

        <!-- TELA DE CONQUISTAS (escondida por padrão) -->
        <div id="achievements-screen" class="hidden flex-col flex-grow">
            <header class="p-4 flex justify-between items-center border-b border-gray-200">
                <button id="back-to-profile-btn" class="text-gray-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg></button>
                <h1 class="text-xl font-semibold text-gray-800">Conquistas</h1>
                <button class="text-gray-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.79 4 4s-1.79 4-4 4c-1.742 0-3.223-.835-3.772-2M12 5v.01M12 19v.01M21 12h-.01M3 12h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></button>
            </header>

            <main class="flex-grow p-4 bg-gray-50 overflow-y-auto no-scrollbar">
                <div class="mb-6">
                    <h2 class="text-lg font-semibold text-gray-800">Parcelas seguidas sem atraso</h2>
                    <p class="text-sm text-gray-500">Pague suas parcelas em dia para receber medalhas.</p>
                </div>

                <div id="main-progress-container" class="bg-white p-4 rounded-xl border border-gray-200 mb-6 transition-all">
                    <div id="completion-message" class="hidden items-center space-x-2 mb-2">
                        <svg class="h-6 w-6 text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <span class="text-green-700 font-semibold">Todas as medalhas da missão foram conquistadas</span>
                    </div>
                    <p id="main-progress-title" class="text-sm font-medium text-gray-600 mb-2">Até a próxima medalha</p>
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-1">
                        <div id="main-progress-bar" class="bg-green-400 h-2 rounded-full transition-all" style="width: 0%"></div>
                    </div>
                    <p id="main-progress-text" class="text-right text-sm font-medium text-gray-500">0/4</p>
                </div>

                <div id="medal-grid" class="grid grid-cols-3 gap-4 text-center">
                    <!-- As medalhas serão preenchidas pelo JS -->
                </div>

                <div class="mt-8 text-center space-y-4">
                     <button id="advance-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-all">Pagar Parcela (Simular)</button>
                     <button id="reset-btn" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-all">Resetar Simulação</button>
                </div>
            </main>
        </div>

        <!-- TELA DE CUPONS (escondida por padrão) -->
        <div id="cupons-screen" class="hidden flex-col flex-grow">
            <header class="p-4 flex justify-between items-center border-b border-gray-200">
                <button id="back-to-profile-from-cupons-btn" class="text-gray-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg></button>
                <h1 class="text-xl font-semibold text-gray-800">Cupons</h1>
                <div class="w-6 h-6"></div>
            </header>
            <main class="flex-grow p-4 bg-gray-50 overflow-y-auto no-scrollbar">
                <div id="cupons-content" class="space-y-4">
                    <!-- O conteúdo será preenchido pelo JavaScript baseado no status do clube -->
                </div>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- ELEMENTOS DO DOM ---
            const profileScreen = document.getElementById('profile-screen');
            const achievementsScreen = document.getElementById('achievements-screen');
            const benefitsScreen = document.getElementById('benefits-screen');
            const activeSubscriptionScreen = document.getElementById('active-subscription-screen');
            const plansScreen = document.getElementById('plans-screen');
            const paymentScreen = document.getElementById('payment-screen');
            const purchaseSimulationScreen = document.getElementById('purchase-simulation-screen');
            const rankingScreen = document.getElementById('ranking-screen');
            const showAchievementsBtn = document.getElementById('show-achievements-btn');
            const clubeBeneficiosBtn = document.getElementById('clube-beneficios-btn');
            const cuponsScreen = document.getElementById('cupons-screen');
            const cuponsBtn = document.getElementById('cupons-btn');
            const simularCompraBtn = document.getElementById('simular-compra-btn');
            const backToProfileBtn = document.getElementById('back-to-profile-btn');
            const backToProfileFromBenefitsBtn = document.getElementById('back-to-profile-from-benefits-btn');
            const backToProfileFromActiveBtn = document.getElementById('back-to-profile-from-active-btn');
            const backToProfileFromPurchaseBtn = document.getElementById('back-to-profile-from-purchase-btn');
            const backToProfileFromCuponsBtn = document.getElementById('back-to-profile-from-cupons-btn');
            const backToBenefitsBtn = document.getElementById('back-to-benefits-btn');
            const backToPlansBtn = document.getElementById('back-to-plans-btn');
            const subscribeBtn = document.getElementById('subscribe-btn');
            const continueToPaymentBtn = document.getElementById('continue-to-payment-btn');
            const simulatePaymentBtn = document.getElementById('simulate-payment-btn');
            const planOptions = document.querySelectorAll('.plan-option');
            const selectedPlanSummary = document.getElementById('selected-plan-summary');
            const paymentTotal = document.getElementById('payment-total');
            const subscriptionDetails = document.getElementById('subscription-details');
            const cancelSubscriptionBtn = document.getElementById('cancel-subscription-btn');
            const cashbackInfo = document.getElementById('cashback-info');
            const purchaseActionSection = document.getElementById('purchase-action-section');
            const serviceFeeSavings = document.getElementById('service-fee-savings');
            const totalSavings = document.getElementById('total-savings');
            const cashbackBalance = document.getElementById('cashback-balance');
            const advanceBtn = document.getElementById('advance-btn');
            const resetBtn = document.getElementById('reset-btn');
            const medalGrid = document.getElementById('medal-grid');
            const mainProgressBar = document.getElementById('main-progress-bar');
            const mainProgressText = document.getElementById('main-progress-text');
            const mainProgressContainer = document.getElementById('main-progress-container');
            const mainProgressTitle = document.getElementById('main-progress-title');
            const completionMessage = document.getElementById('completion-message');
            const showRankingBtn = document.getElementById('show-ranking-btn');
            const backToProfileFromRankingBtn = document.getElementById('back-to-profile-from-ranking-btn');
            const completeMissionBtn = document.getElementById('complete-mission-btn');
            const userPosition = document.getElementById('user-position');
            const rankingList = document.getElementById('ranking-list');
            const podiumContainer = document.getElementById('podium-container');

            // --- ESTADO DA SIMULAÇÃO ---
            let currentProgress = 0;
            const MAX_PROGRESS = 64;
            let selectedPlan = null;
            
            // --- SISTEMA DE PERSISTÊNCIA COM LOCALSTORAGE ---
            const STORAGE_KEYS = {
                USER_DATA: 'pagaleve_user_data',
                SUBSCRIPTION: 'pagaleve_subscription',
                CASHBACK: 'pagaleve_cashback',
                RANKING: 'pagaleve_ranking',
                CUPONS: 'pagaleve_cupons'
            };

            // Função para carregar dados do localStorage
            const loadFromStorage = (key, defaultValue) => {
                try {
                    const stored = localStorage.getItem(key);
                    return stored ? JSON.parse(stored) : defaultValue;
                } catch (e) {
                    console.warn(`Erro ao carregar ${key} do localStorage:`, e);
                    return defaultValue;
                }
            };

            // Função para salvar dados no localStorage
            const saveToStorage = (key, value) => {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                } catch (e) {
                    console.warn(`Erro ao salvar ${key} no localStorage:`, e);
                }
            };

            // Função para limpar todos os dados do localStorage (útil para desenvolvimento)
            const clearAppStorage = () => {
                Object.values(STORAGE_KEYS).forEach(key => {
                    localStorage.removeItem(key);
                });
                console.log('Todos os dados do app foram removidos do localStorage');
            };

            // Para facilitar o desenvolvimento, expõe no console
            window.clearAppStorage = clearAppStorage;
            window.debugStorage = () => {
                console.log('=== ESTADO ATUAL DO LOCALSTORAGE ===');
                console.log('Subscription:', loadFromStorage(STORAGE_KEYS.SUBSCRIPTION, null));
                console.log('Cashback:', loadFromStorage(STORAGE_KEYS.CASHBACK, null));
                console.log('Ranking:', loadFromStorage(STORAGE_KEYS.RANKING, null));
                console.log('Cupons:', loadFromStorage(STORAGE_KEYS.CUPONS, null));
                console.log('===================================');
            };
            window.addTestCashback = () => addCashback(50, 'Teste de cashback');
            window.testCouponUsage = (couponId) => useCoupon(couponId);

            // --- ESTADO DA ASSINATURA ---
            let isSubscribed = loadFromStorage(STORAGE_KEYS.SUBSCRIPTION, { active: false, plan: null, startDate: null, endDate: null }).active;
            let activeSubscription = loadFromStorage(STORAGE_KEYS.SUBSCRIPTION, { active: false, plan: null, startDate: null, endDate: null });
            // --- SISTEMA DE CASHBACK COM LOCALSTORAGE ---
            let cashbackData = loadFromStorage(STORAGE_KEYS.CASHBACK, { balance: 0, history: [] });
            let cashbackBalanceAmount = cashbackData.balance;
            
            // --- ESTADO DO RANKING ---
            let userMissions = loadFromStorage(STORAGE_KEYS.RANKING, { missions: 115, position: null, history: [] }).missions;
            let userRanking = 5;
            
            // --- ESTADO DA SIMULAÇÃO DE COMPRA ---
            // Removido o estado do expansor

            // --- DEFINIÇÕES DAS MEDALHAS ---
            const medals = [
                { goal: 4,  unlocked: false, color: 'bg-green-400', ribbon: '#34D399' },
                { goal: 8,  unlocked: false, color: 'bg-purple-400', ribbon: '#A78BFA' },
                { goal: 16, unlocked: false, color: 'bg-blue-400', ribbon: '#60A5FA' },
                { goal: 32, unlocked: false, color: 'bg-yellow-400', ribbon: '#FBBF24' },
                { goal: 48, unlocked: false, color: 'bg-red-400', ribbon: '#F87171' },
                { goal: 64, unlocked: false, color: 'bg-teal-400', ribbon: '#2DD4BF' },
            ];

            // --- DEFINIÇÕES DOS CUPONS ---
            const defaultCupons = [
                { 
                    id: 1, 
                    title: 'R$ 10 OFF', 
                    description: 'Em compras acima de R$ 200', 
                    code: 'SAVE10', 
                    expiration: '31/12/2024',
                    value: 10,
                    minValue: 200
                },
                { 
                    id: 2, 
                    title: 'R$ 15 OFF', 
                    description: 'Em compras acima de R$ 300', 
                    code: 'SAVE15', 
                    expiration: '30/11/2024',
                    value: 15,
                    minValue: 300
                },
                { 
                    id: 3, 
                    title: 'R$ 25 OFF', 
                    description: 'Em compras acima de R$ 500', 
                    code: 'SAVE25', 
                    expiration: '15/11/2024',
                    value: 25,
                    minValue: 500
                },
                { 
                    id: 4, 
                    title: 'R$ 50 OFF', 
                    description: 'Em compras acima de R$ 1000', 
                    code: 'SAVE50', 
                    expiration: '01/01/2025',
                    value: 50,
                    minValue: 1000
                },
                { 
                    id: 5, 
                    title: '20% OFF', 
                    description: 'Em compras acima de R$ 150', 
                    code: 'PERCENT20', 
                    expiration: '25/12/2024',
                    value: 20,
                    minValue: 150,
                    isPercentage: true
                }
            ];

            // --- SISTEMA DE CUPONS COM LOCALSTORAGE ---
            let cupons = loadFromStorage(STORAGE_KEYS.CUPONS, {
                available: [...defaultCupons],
                used: []
            });

            // Funcões para gerenciar cupons
            const saveCupons = () => {
                saveToStorage(STORAGE_KEYS.CUPONS, cupons);
            };

            const useCoupon = (couponId) => {
                const couponIndex = cupons.available.findIndex(c => c.id === couponId);
                if (couponIndex !== -1) {
                    const usedCoupon = cupons.available.splice(couponIndex, 1)[0];
                    cupons.used.push({
                        ...usedCoupon,
                        usedAt: new Date().toISOString()
                    });
                    saveCupons();
                    return true;
                }
                return false;
            };

            const getAvailableCoupons = () => cupons.available;
            const getUsedCoupons = () => cupons.used;

            // --- SVGs ---
            const lockedIconSVG = `
                <div class="w-16 h-16 flex items-center justify-center bg-gray-100 rounded-full mb-2 transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </div>`;

            const unlockedIconSVG = (color, ribbon) => `
                <div class="w-16 h-16 flex items-center justify-center rounded-full mb-2 transition-all ${color}">
                    <svg width="50" height="50" viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4.75 19V11.0833C4.75 11.0833 4.75 6.33333 9.5 4.75C14.25 3.16667 19 6.33333 19 6.33333C19 6.33333 23.75 3.16667 28.5 4.75C33.25 6.33333 33.25 11.0833 33.25 11.0833V19C33.25 26.9167 19 34.8333 19 34.8333C19 34.8333 4.75 26.9167 4.75 19Z" fill="${ribbon}"/>
                        <path d="M19.0002 24.3333C22.1164 24.3333 24.6668 21.8229 24.6668 18.75C24.6668 15.6771 22.1164 13.1667 19.0002 13.1667C15.8839 13.1667 13.3335 15.6771 13.3335 18.75C13.3335 21.8229 15.8839 24.3333 19.0002 24.3333Z" fill="white"/>
                        <path d="M19 16.5833V20.9167M19 20.9167C19.9868 20.9167 21.3333 20.4271 21.3333 18.75C21.3333 17.0729 19.9868 16.5833 19 16.5833M19 20.9167C18.0132 20.9167 16.6667 20.4271 16.6667 18.75C16.6667 17.0729 18.0132 16.5833 19 16.5833M19 16.5833L19.7917 15.4167M19 16.5833L18.2083 15.4167M19 20.9167L18.2083 22.0833M19 20.9167L19.7917 22.0833" stroke="#${ribbon.substring(1)}" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>`;

            // --- FUNÇÕES DE ASSINATURA ---
            const updateSubscriptionDetails = () => {
                if (!activeSubscription) return;
                
                const planNames = {1: 'Mensal', 3: 'Trimestral', 6: 'Semestral'};
                const startDate = new Date(activeSubscription.startDate);
                const endDate = new Date(activeSubscription.endDate);
             
                
                monthsRemaining = Math.max(0, activeSubscription.months);
                
                subscriptionDetails.innerHTML = `
                    <div class="flex justify-between items-center py-2 border-b border-gray-100">
                        <span class="text-gray-600">Plano</span>
                        <span class="font-semibold">${planNames[activeSubscription.months]}</span>
                    </div>
                    <div class="flex justify-between items-center py-2 border-b border-gray-100">
                        <span class="text-gray-600">Valor pago</span>
                        <span class="font-semibold">R$ ${activeSubscription.price.toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between items-center py-2 border-b border-gray-100">
                        <span class="text-gray-600">Início da assinatura</span>
                        <span class="font-semibold">${startDate.toLocaleDateString('pt-BR')}</span>
                    </div>
                    <div class="flex justify-between items-center py-2 border-b border-gray-100">
                        <span class="text-gray-600">Próxima renovação</span>
                        <span class="font-semibold">${endDate.toLocaleDateString('pt-BR')}</span>
                    </div>
                    <div class="flex justify-between items-center py-2">
                        <span class="text-gray-600">Tempo restante</span>
                        <span class="font-semibold text-green-600">${monthsRemaining} mês${monthsRemaining !== 1 ? 'es' : ''}</span>
                    </div>
                `;
            };
            
            const activateSubscription = (plan) => {
                isSubscribed = true;
                const startDate = new Date();
                const endDate = new Date();
                endDate.setMonth(endDate.getMonth() + plan.months);
                
                activeSubscription = {
                    ...plan,
                    active: true,
                    startDate: startDate.toISOString(),
                    endDate: endDate.toISOString()
                };
                
                // Salva no localStorage
                saveToStorage(STORAGE_KEYS.SUBSCRIPTION, activeSubscription);
                
                updateSubscriptionDetails();
                updateSubscriptionUI();
            };
            
            const cancelSubscription = () => {
                if (confirm('Tem certeza de que deseja cancelar sua assinatura?\n\nVocê perderá todos os benefícios do Clube de Benefícios imediatamente.')) {
                    // Reset do estado da assinatura
                    isSubscribed = false;
                    activeSubscription = { active: false, plan: null, startDate: null, endDate: null };
                    
                    // Salva no localStorage
                    saveToStorage(STORAGE_KEYS.SUBSCRIPTION, activeSubscription);
                    
                    // Reset das seleções de plano
                    selectedPlan = null;
                    planOptions.forEach(opt => {
                        opt.classList.remove('border-purple-500', 'bg-purple-50');
                        opt.classList.add('border-gray-200');
                    });
                    continueToPaymentBtn.disabled = true;
                    continueToPaymentBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    continueToPaymentBtn.classList.remove('opacity-100', 'cursor-pointer');
                    
                    // Limpa detalhes da assinatura
                    subscriptionDetails.innerHTML = '';
                    selectedPlanSummary.innerHTML = '';
                    paymentTotal.textContent = 'R$ 0,00';
                    
                    // Volta para o perfil
                    activeSubscriptionScreen.classList.add('hidden');
                    activeSubscriptionScreen.classList.remove('flex');
                    profileScreen.classList.remove('hidden');
                    
                    // Atualiza o saldo de cashback e UI
                    updateSubscriptionUI();
                    
                    alert('Assinatura cancelada com sucesso.\n\nSeus benefícios foram desativados. Você pode reativar a qualquer momento!');
                }
            };
            
            // --- FUNÇÕES DE CASHBACK ---
            const updateCashbackBalance = () => {
                if (isSubscribed) {
                    cashbackBalance.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01M12 6v-1h4v1m-4 0h-4v-1h4m0 10v1h4v-1m-4 0h-4v1h4" />
                        </svg>
                        <span class="text-sm font-medium text-green-600">Cashback: R$ ${cashbackBalanceAmount.toFixed(2)}</span>
                    `;
                } else {
                    cashbackBalance.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01M12 6v-1h4v1m-4 0h-4v-1h4m0 10v1h4v-1m-4 0h-4v1h4" />
                        </svg>
                        <span class="text-sm text-gray-500">Cashback: R$ 0,00</span>
                    `;
                }
            };
            
            const saveCashback = () => {
                cashbackData.balance = cashbackBalanceAmount;
                saveToStorage(STORAGE_KEYS.CASHBACK, cashbackData);
            };

            const addCashback = (amount, description = 'Cashback recebido') => {
                if (isSubscribed) {
                    cashbackBalanceAmount += amount;
                    
                    // Adiciona ao histórico
                    cashbackData.history.push({
                        amount: amount,
                        description: description,
                        date: new Date().toISOString(),
                        type: 'credit'
                    });
                    
                    saveCashback();
                    updateCashbackBalance();
                    updateCashbackDisponivel();
                    return true;
                }
                return false;
            };

            const useCashback = (amount, description = 'Cashback usado') => {
                if (isSubscribed && cashbackBalanceAmount >= amount) {
                    cashbackBalanceAmount -= amount;
                    
                    // Adiciona ao histórico
                    cashbackData.history.push({
                        amount: -amount,
                        description: description,
                        date: new Date().toISOString(),
                        type: 'debit'
                    });
                    
                    saveCashback();
                    updateCashbackBalance();
                    updateCashbackDisponivel();
                    return true;
                }
                return false;
            };

            const getCashbackHistory = () => {
                return cashbackData.history.slice().reverse(); // Retorna histórico ordenado por data (mais recente primeiro)
            };

            // --- FUNÇÕES DE ATUALIZAÇÃO DE INTERFACE ---
            const updateSubscriptionStatus = () => {
                const subscriptionStatus = document.getElementById('subscription-status');
                if (isSubscribed) {
                    subscriptionStatus.innerHTML = `<span>Ativo</span>`;
                } else {
                    subscriptionStatus.innerHTML = `<span>Inativo</span>`;
                }
            };

            const updateSubscriptionActionBtn = () => {
                const buttonsContainer = document.getElementById('subscription-buttons-container');
                
                if (isSubscribed) {
                    // Para usuários assinados: dois botões lado a lado
                    buttonsContainer.innerHTML = `
                        <div class="flex space-x-3">
                            <button id="faca-compra-btn" class="flex-1 bg-green-500 text-white font-medium py-3 px-4 rounded-lg hover:bg-green-600 transition-colors">
                                Faça uma compra
                            </button>
                            <button id="ver-beneficios-btn" class="flex-1 bg-white border border-purple-500 text-purple-500 font-medium py-3 px-4 rounded-lg hover:bg-purple-50 transition-colors">
                                Ver meus benefícios
                            </button>
                        </div>
                    `;
                    
                    // Event listeners para os novos botões
                    document.getElementById('faca-compra-btn').onclick = () => {
                        profileScreen.classList.add('hidden');
                        purchaseSimulationScreen.classList.remove('hidden');
                        purchaseSimulationScreen.classList.add('flex');
                    };
                    
                    document.getElementById('ver-beneficios-btn').onclick = () => {
                        profileScreen.classList.add('hidden');
                        activeSubscriptionScreen.classList.remove('hidden');
                        activeSubscriptionScreen.classList.add('flex');
                    };
                } else {
                    // Para usuários não assinados: botão único
                    buttonsContainer.innerHTML = `
                        <button id="subscription-action-btn" class="w-full bg-purple-500 text-white font-medium py-3 px-4 rounded-lg hover:bg-purple-600 transition-colors">
                            Assine seu plano
                        </button>
                    `;
                    
                    document.getElementById('subscription-action-btn').onclick = () => {
                        profileScreen.classList.add('hidden');
                        benefitsScreen.classList.remove('hidden');
                        benefitsScreen.classList.add('flex');
                    };
                }
            };

            const updateCuponsSection = () => {
                const cuponsTitle = document.getElementById('cupons-section-title');
                const cuponsSubtitle = document.getElementById('cupons-section-subtitle');
                const cuponsRestamText = document.getElementById('cupons-restam-text');
                
                if (isSubscribed) {
                    cuponsTitle.textContent = "Cupons da assinatura";
                    cuponsSubtitle.textContent = "2 para todos os restaurantes";
                    cuponsSubtitle.style.display = "block";
                    cuponsRestamText.innerHTML = 'Restam <span class="font-semibold text-purple-600">2 de 2 cupons</span>';
                    cuponsRestamText.style.display = "block";
                } else {
                    cuponsTitle.textContent = "Cupons";
                    cuponsSubtitle.style.display = "none";
                    cuponsRestamText.style.display = "none";
                }
            };

            const updateRankingPreview = () => {
                const rankingPosition = document.getElementById('ranking-position');
                const rankingMissions = document.getElementById('ranking-missions');
                
                // Atualiza os valores com base nas variáveis globais
                rankingPosition.textContent = `${userRanking}°`;
                rankingMissions.textContent = userMissions;
            };

            const updateCashbackDisponivel = () => {
                const cashbackDisponivelElement = document.getElementById('cashback-disponivel');
                if (cashbackDisponivelElement) {
                    cashbackDisponivelElement.textContent = `R$ ${cashbackBalanceAmount.toFixed(2)}`;
                }
            };

            const updateSubscriptionUI = () => {
                updateSubscriptionStatus();
                updateSubscriptionActionBtn();
                updateCashbackBalance();
                updateCuponsSection();
                updateRankingPreview();
                updateCashbackDisponivel();
                // Atualiza também a tela de simulação de compra
                updateCashbackInfo();
                updateServiceFeeSavings();
                updateTotalSavings();
                updatePurchaseActionSection();
            };

            // --- FUNÇÕES DE SIMULAÇÃO DE COMPRA ---
            const updateCashbackInfo = () => {
                const purchaseAmount = 1000;
                const cashbackRate = isSubscribed ? 0.01 : 0; // 1% para assinantes
                const cashbackAmount = purchaseAmount * cashbackRate;
                
                if (isSubscribed) {
                    cashbackInfo.innerHTML = `
                        <div class="flex items-center space-x-2 text-pink-600">
                            <span>Ganhe R$ ${cashbackAmount.toFixed(2)} de cashback</span>
                            <svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 5h2v2H9V5Zm0 4h2v6H9V9Zm1-9C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0Zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8Z" fill="#FE35F1"/>
                            </svg>
                        </div>
                    `;
                } else {
                    cashbackInfo.innerHTML = `
                        <div class="flex items-center space-x-2 text-gray-500">
                            <span>Ganharia R$ 10,00 de cashback no Clube</span>
                            <svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 5h2v2H9V5Zm0 4h2v6H9V9Zm1-9C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0Zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8Z" fill="#9CA3AF"/>
                            </svg>
                        </div>
                    `;
                }
            };
            
            const updateServiceFeeSavings = () => {
                const serviceFee = 20;
                const discountRate = 0.20; // 20% de desconto
                const savings = serviceFee * discountRate;
                
                if (isSubscribed) {
                    serviceFeeSavings.innerHTML = `
                        <div class="flex items-center justify-between">
                            <span class="text-blue-800 font-medium">✓ Economia na taxa de serviço (20%)</span>
                            <span class="text-blue-800 font-semibold">-R$ ${savings.toFixed(2)}</span>
                        </div>
                    `;
                } else {
                    serviceFeeSavings.innerHTML = `
                        <div class="flex items-center justify-between">
                            <span class="text-blue-600 font-medium">Economizaria na taxa (20%)</span>
                            <span class="text-blue-600 font-semibold">-R$ ${savings.toFixed(2)}</span>
                        </div>
                    `;
                }
            };
            
            const updateTotalSavings = () => {
                const purchaseAmount = 1000;
                const serviceFee = 20;
                const cashbackAmount = isSubscribed ? purchaseAmount * 0.01 : 0;
                const serviceFeeDiscount = isSubscribed ? serviceFee * 0.20 : 0;
                const totalSavingsAmount = cashbackAmount + serviceFeeDiscount;
                
                if (isSubscribed && totalSavingsAmount > 0) {
                    totalSavings.innerHTML = `Economia total nesta compra: R$ ${totalSavingsAmount.toFixed(2)}`;
                } else if (!isSubscribed) {
                    const potentialSavings = (purchaseAmount * 0.01) + (serviceFee * 0.20);
                    totalSavings.innerHTML = `Economizaria R$ ${potentialSavings.toFixed(2)} no Clube de Benefícios`;
                } else {
                    totalSavings.innerHTML = '';
                }
            };
            
            const updatePurchaseActionSection = () => {
                if (isSubscribed) {
                    purchaseActionSection.innerHTML = `
                        <button id="finalize-purchase-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-xl transition-all text-lg shadow-lg">
                            Finalizar Compra
                        </button>
                    `;
                    
                    // Adiciona event listener para finalizar compra
                    const finalizePurchaseBtn = document.getElementById('finalize-purchase-btn');
                    if (finalizePurchaseBtn) {
                        finalizePurchaseBtn.addEventListener('click', () => {
                            const cashbackAmount = 10.00; // R$ 10,00 de cashback
                            if (addCashback(cashbackAmount, 'Cashback da compra simulada')) {
                                alert(`🎉 Compra finalizada com sucesso!\n\n✅ R$ ${cashbackAmount.toFixed(2)} de cashback adicionado ao seu saldo!\n\nSeu novo saldo: R$ ${cashbackBalanceAmount.toFixed(2)}`);
                                
                                // Volta para o perfil
                                purchaseSimulationScreen.classList.add('hidden');
                                purchaseSimulationScreen.classList.remove('flex');
                                profileScreen.classList.remove('hidden');
                            }
                        });
                    }
                } else {
                    purchaseActionSection.innerHTML = `
                        <div class="space-y-4">
                            <div class="bg-purple-50 border-2 border-purple-200 rounded-xl p-4">
                                <div class="flex items-center space-x-3 mb-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                                    </svg>
                                    <div>
                                        <h3 class="font-semibold text-purple-800">Clube de Benefícios</h3>
                                        <p class="text-sm text-purple-600">Ganhe R$ 10,00 de cashback nesta compra!</p>
                                    </div>
                                </div>
                                <button id="join-club-from-purchase" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-lg transition-all">
                                    Aderir ao Clube e Ganhar Cashback
                                </button>
                            </div>
                            <button class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-4 px-6 rounded-xl transition-all text-lg">
                                Finalizar Compra Sem Benefícios
                            </button>
                        </div>
                    `;
                    
                    // Adiciona event listener para o botão de aderir ao clube
                    const joinClubFromPurchaseBtn = document.getElementById('join-club-from-purchase');
                    if (joinClubFromPurchaseBtn) {
                        joinClubFromPurchaseBtn.addEventListener('click', () => {
                            // Vai para a tela de benefícios
                            purchaseSimulationScreen.classList.add('hidden');
                            purchaseSimulationScreen.classList.remove('flex');
                            benefitsScreen.classList.remove('hidden');
                            benefitsScreen.classList.add('flex');
                        });
                    }
                }
            };

            // --- FUNÇÕES ---
            const renderMedals = () => {
                medalGrid.innerHTML = '';
                medals.forEach(medal => {
                    const medalEl = document.createElement('div');
                    medalEl.id = `medal-${medal.goal}`;
                    medalEl.className = 'flex flex-col items-center justify-center p-3 bg-white border border-gray-200 rounded-xl transition-all';
                    
                    const iconContainer = document.createElement('div');
                    iconContainer.id = `medal-icon-${medal.goal}`;
                    iconContainer.innerHTML = medal.unlocked ? unlockedIconSVG(medal.color, medal.ribbon) : lockedIconSVG;
                    
                    const textEl = document.createElement('span');
                    textEl.id = `medal-text-${medal.goal}`;
                    textEl.className = 'text-sm font-semibold text-gray-500 border border-gray-300 rounded-full px-3 py-1 transition-all';
                    textEl.textContent = `${medal.unlocked ? medal.goal : currentProgress > medal.goal ? medal.goal : currentProgress}/${medal.goal}`;

                    if (medal.unlocked) {
                        medalEl.classList.add('medal-unlocked');
                        textEl.classList.add('border-green-400', 'text-green-700');
                    }

                    medalEl.appendChild(iconContainer);
                    medalEl.appendChild(textEl);
                    medalGrid.appendChild(medalEl);
                });
            };

            const updateUI = () => {
                // Atualiza medalhas individuais
                medals.forEach(medal => {
                    if (currentProgress >= medal.goal && !medal.unlocked) {
                        medal.unlocked = true;
                        const medalEl = document.getElementById(`medal-${medal.goal}`);
                        const iconEl = document.getElementById(`medal-icon-${medal.goal}`);
                        medalEl.classList.add('medal-unlocked');
                        iconEl.innerHTML = unlockedIconSVG(medal.color, medal.ribbon);
                    }
                    const textEl = document.getElementById(`medal-text-${medal.goal}`);
                    const currentDisplay = medal.unlocked ? medal.goal : Math.min(currentProgress, medal.goal);
                    textEl.textContent = `${currentDisplay}/${medal.goal}`;
                     if (medal.unlocked) {
                        textEl.classList.add('border-green-400', 'text-green-700');
                    }
                });

                // Atualiza barra de progresso principal
                const nextMedal = medals.find(m => !m.unlocked);
                if (nextMedal) {
                    const prevGoal = medals[medals.indexOf(nextMedal) - 1]?.goal || 0;
                    const percentage = ((currentProgress - prevGoal) / (nextMedal.goal - prevGoal)) * 100;
                    mainProgressBar.style.width = `${Math.min(percentage, 100)}%`;
                    mainProgressText.textContent = `${currentProgress}/${nextMedal.goal}`;
                } else {
                    // Todas as medalhas conquistadas
                    mainProgressBar.style.width = '100%';
                    mainProgressContainer.classList.add('bg-green-100', 'border-green-200');
                    mainProgressTitle.classList.add('hidden');
                    completionMessage.classList.remove('hidden');
                    completionMessage.classList.add('flex');
                    mainProgressText.textContent = `${MAX_PROGRESS}/${MAX_PROGRESS}`;
                    advanceBtn.disabled = true;
                }
            };
            
            const resetSimulation = () => {
                currentProgress = 0;
                medals.forEach(m => m.unlocked = false);
                mainProgressBar.style.width = '0%';
                mainProgressText.textContent = '0/4';
                mainProgressContainer.classList.remove('bg-green-100', 'border-green-200');
                mainProgressTitle.classList.remove('hidden');
                completionMessage.classList.add('hidden');
                completionMessage.classList.remove('flex');
                advanceBtn.disabled = false;
                renderMedals();
            };

            // --- FUNÇÕES DOS CUPONS ---
            const renderCupons = () => {
                const cuponsContent = document.getElementById('cupons-content');
                
                if (isSubscribed) {
                    // Membro do clube - mostra todos os cupons desbloqueados
                    cuponsContent.innerHTML = `
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center space-x-2 mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <h2 class="text-lg font-semibold text-green-700">Membro do Clube</h2>
                            </div>
                            <p class="text-sm text-green-600">Você tem acesso total aos cupons! Use os códigos abaixo:</p>
                        </div>
                        ${getAvailableCoupons().map(cupon => `
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                                            </svg>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-800">${cupon.title}</h3>
                                            <p class="text-sm text-gray-600">${cupon.description}</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-medium">
                                            DISPONÍVEL
                                        </div>
                                    </div>
                                </div>
                                <div class="border-t border-gray-100 pt-3 mt-3">
                                    <div class="flex items-center justify-between">
                                        <div class="bg-gray-100 px-3 py-2 rounded-lg">
                                            <span class="text-sm font-mono font-semibold text-gray-800">${cupon.code}</span>
                                        </div>
                                        <div class="text-right text-sm">
                                            <span class="text-gray-500">Válido até:</span>
                                            <div class="font-semibold text-gray-800">${cupon.expiration}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    `;
                } else {
                    // Não é membro do clube - mostra cupons bloqueados
                    cuponsContent.innerHTML = `
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center space-x-2 mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                </svg>
                                <h2 class="text-lg font-semibold text-orange-700">Cupons Exclusivos do Clube</h2>
                            </div>
                            <p class="text-sm text-orange-600">Torne-se membro do Clube de Benefícios para desbloquear os cupons!</p>
                        </div>
                        ${getAvailableCoupons().map(cupon => `
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm opacity-60 relative overflow-hidden">
                                <div class="absolute inset-0 bg-gray-100 bg-opacity-50"></div>
                                <div class="relative">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-12 h-12 bg-gray-300 rounded-lg flex items-center justify-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                                </svg>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-600">${cupon.title}</h3>
                                                <p class="text-sm text-gray-500">${cupon.description}</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <div class="bg-gray-200 text-gray-600 px-2 py-1 rounded text-xs font-medium">
                                                BLOQUEADO
                                            </div>
                                        </div>
                                    </div>
                                    <div class="border-t border-gray-100 pt-3 mt-3">
                                        <div class="flex items-center justify-between">
                                            <div class="bg-gray-200 px-3 py-2 rounded-lg">
                                                <span class="text-sm font-mono font-semibold text-gray-500">••••••</span>
                                            </div>
                                            <div class="text-right text-sm">
                                                <span class="text-gray-400">Expira em:</span>
                                                <div class="font-semibold text-gray-500">${cupon.expiration}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        <div class="mt-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg p-4 text-white text-center">
                            <h3 class="font-semibold mb-2">Desbloqueie todos os cupons!</h3>
                            <p class="text-sm mb-3">Torne-se membro do Clube e ganhe acesso a cupons exclusivos</p>
                            <button id="join-club-from-cupons" class="bg-white text-purple-600 font-semibold py-2 px-4 rounded-lg hover:bg-gray-100 transition-colors">
                                Aderir ao Clube
                            </button>
                        </div>
                    `;
                    
                    // Adiciona event listener para o botão de aderir ao clube
                    const joinClubFromCuponsBtn = document.getElementById('join-club-from-cupons');
                    if (joinClubFromCuponsBtn) {
                        joinClubFromCuponsBtn.addEventListener('click', () => {
                            cuponsScreen.classList.add('hidden');
                            cuponsScreen.classList.remove('flex');
                            benefitsScreen.classList.remove('hidden');
                            benefitsScreen.classList.add('flex');
                        });
                    }
                }
            };

            const advanceProgress = () => {
                if (currentProgress < MAX_PROGRESS) {
                    currentProgress++;
                    updateUI();
                }
            };

            // --- EVENT LISTENERS ---
            showAchievementsBtn.addEventListener('click', () => {
                profileScreen.classList.add('hidden');
                achievementsScreen.classList.remove('hidden');
                achievementsScreen.classList.add('flex');
                resetSimulation();
            });
            
            clubeBeneficiosBtn.addEventListener('click', () => {
                profileScreen.classList.add('hidden');
                if (isSubscribed) {
                    // Se já é assinante, mostra tela de assinatura ativa
                    activeSubscriptionScreen.classList.remove('hidden');
                    activeSubscriptionScreen.classList.add('flex');
                    updateSubscriptionDetails();
                } else {
                    // Se não é assinante, mostra tela de benefícios
                    benefitsScreen.classList.remove('hidden');
                    benefitsScreen.classList.add('flex');
                }
            });

            cuponsBtn.addEventListener('click', () => {
                profileScreen.classList.add('hidden');
                cuponsScreen.classList.remove('hidden');
                cuponsScreen.classList.add('flex');
                renderCupons();
            });

            // Event listener para "Ver detalhes" da seção de cupons na tela inicial
            const cuponsVerDetalhesBtn = document.getElementById('cupons-ver-detalhes-btn');
            cuponsVerDetalhesBtn.addEventListener('click', () => {
                profileScreen.classList.add('hidden');
                cuponsScreen.classList.remove('hidden');
                cuponsScreen.classList.add('flex');
                renderCupons();
            });

            // Event listener para "Ver ranking" da seção de ranking na tela inicial
            const rankingVerDetalhesBtn = document.getElementById('ranking-ver-detalhes-btn');
            rankingVerDetalhesBtn.addEventListener('click', () => {
                profileScreen.classList.add('hidden');
                rankingScreen.classList.remove('hidden');
                rankingScreen.classList.add('flex');
                updateRankingDisplay();
            });

            // Event listener para "Ver todas" da seção de conquistas na tela inicial
            const conquistasVerDetalhesBtn = document.getElementById('conquistas-ver-detalhes-btn');
            conquistasVerDetalhesBtn.addEventListener('click', () => {
                profileScreen.classList.add('hidden');
                achievementsScreen.classList.remove('hidden');
                achievementsScreen.classList.add('flex');
                renderMedals();
            });
            
            backToProfileBtn.addEventListener('click', () => {
                achievementsScreen.classList.add('hidden');
                achievementsScreen.classList.remove('flex');
                profileScreen.classList.remove('hidden');
            });
            
            backToProfileFromBenefitsBtn.addEventListener('click', () => {
                benefitsScreen.classList.add('hidden');
                benefitsScreen.classList.remove('flex');
                profileScreen.classList.remove('hidden');
            });
            
            backToProfileFromActiveBtn.addEventListener('click', () => {
                activeSubscriptionScreen.classList.add('hidden');
                activeSubscriptionScreen.classList.remove('flex');
                profileScreen.classList.remove('hidden');
            });
            
            simularCompraBtn.addEventListener('click', () => {
                profileScreen.classList.add('hidden');
                purchaseSimulationScreen.classList.remove('hidden');
                purchaseSimulationScreen.classList.add('flex');
                updateCashbackInfo();
                updateServiceFeeSavings();
                updateTotalSavings();
                updatePurchaseActionSection();
            });
            
            backToProfileFromPurchaseBtn.addEventListener('click', () => {
                purchaseSimulationScreen.classList.add('hidden');
                purchaseSimulationScreen.classList.remove('flex');
                profileScreen.classList.remove('hidden');
            });

            backToProfileFromCuponsBtn.addEventListener('click', () => {
                cuponsScreen.classList.add('hidden');
                cuponsScreen.classList.remove('flex');
                profileScreen.classList.remove('hidden');
            });
            
            // Removido o event listener do toggle
            
            subscribeBtn.addEventListener('click', () => {
                benefitsScreen.classList.add('hidden');
                benefitsScreen.classList.remove('flex');
                plansScreen.classList.remove('hidden');
                plansScreen.classList.add('flex');
            });
            
            backToBenefitsBtn.addEventListener('click', () => {
                plansScreen.classList.add('hidden');
                plansScreen.classList.remove('flex');
                benefitsScreen.classList.remove('hidden');
                benefitsScreen.classList.add('flex');
            });
            
            backToPlansBtn.addEventListener('click', () => {
                paymentScreen.classList.add('hidden');
                paymentScreen.classList.remove('flex');
                plansScreen.classList.remove('hidden');
                plansScreen.classList.add('flex');
            });
            
            // Seleção de planos
            planOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // Remove seleção anterior
                    planOptions.forEach(opt => {
                        opt.classList.remove('border-purple-500', 'bg-purple-50');
                        opt.classList.add('border-gray-200');
                    });
                    
                    // Adiciona seleção atual
                    option.classList.remove('border-gray-200');
                    option.classList.add('border-purple-500', 'bg-purple-50');
                    
                    // Armazena plano selecionado
                    selectedPlan = {
                        months: parseInt(option.dataset.plan),
                        price: parseFloat(option.dataset.price),
                        total: parseFloat(option.dataset.total)
                    };
                    
                    // Habilita botão de continuar
                    continueToPaymentBtn.disabled = false;
                    continueToPaymentBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    continueToPaymentBtn.classList.add('opacity-100', 'cursor-pointer');
                });
            });
            
            continueToPaymentBtn.addEventListener('click', () => {
                if (selectedPlan) {
                    // Atualiza resumo do plano
                    const planNames = {1: 'Mensal', 3: 'Trimestral', 6: 'Semestral'};
                    const economy = selectedPlan.total - selectedPlan.price;
                    
                    selectedPlanSummary.innerHTML = `
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Plano ${planNames[selectedPlan.months]}</span>
                            <span class="font-semibold">R$ ${selectedPlan.price.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">${selectedPlan.months} mês${selectedPlan.months > 1 ? 'es' : ''} de benefícios</span>
                            <span class="text-sm text-gray-500">R$ ${(selectedPlan.price / selectedPlan.months).toFixed(2)}/mês</span>
                        </div>
                        ${economy > 0 ? `
                        <div class="flex justify-between items-center text-green-600">
                            <span class="text-sm">Economia</span>
                            <span class="font-semibold">R$ ${economy.toFixed(2)}</span>
                        </div>
                        ` : ''}
                        <div class="border-t pt-2 mt-2">
                            <div class="flex justify-between items-center font-bold text-lg">
                                <span>Total</span>
                                <span class="text-purple-600">R$ ${selectedPlan.price.toFixed(2)}</span>
                            </div>
                        </div>
                    `;
                    
                    paymentTotal.textContent = `R$ ${selectedPlan.price.toFixed(2)}`;
                    
                    // Navega para tela de pagamento
                    plansScreen.classList.add('hidden');
                    plansScreen.classList.remove('flex');
                    paymentScreen.classList.remove('hidden');
                    paymentScreen.classList.add('flex');
                }
            });
            
            simulatePaymentBtn.addEventListener('click', () => {
                if (selectedPlan) {
                    // Ativa a assinatura
                    activateSubscription(selectedPlan);
                    
                    // Vai para tela de assinatura ativa
                    paymentScreen.classList.add('hidden');
                    paymentScreen.classList.remove('flex');
                    activeSubscriptionScreen.classList.remove('hidden');
                    activeSubscriptionScreen.classList.add('flex');
                    
                    // Reset selections
                    selectedPlan = null;
                    planOptions.forEach(opt => {
                        opt.classList.remove('border-purple-500', 'bg-purple-50');
                        opt.classList.add('border-gray-200');
                    });
                    continueToPaymentBtn.disabled = true;
                    continueToPaymentBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    continueToPaymentBtn.classList.remove('opacity-100', 'cursor-pointer');
                }
            });
            
            cancelSubscriptionBtn.addEventListener('click', cancelSubscription);
            
            advanceBtn.addEventListener('click', advanceProgress);
            resetBtn.addEventListener('click', resetSimulation);

            // --- RANKING SYSTEM EVENT HANDLERS ---
            showRankingBtn.addEventListener('click', () => {
                profileScreen.classList.add('hidden');
                rankingScreen.classList.remove('hidden');
                rankingScreen.classList.add('flex');
                updateRankingDisplay();
            });
            
            backToProfileFromRankingBtn.addEventListener('click', () => {
                rankingScreen.classList.add('hidden');
                rankingScreen.classList.remove('flex');
                profileScreen.classList.remove('hidden');
            });
            
            completeMissionBtn.addEventListener('click', () => {
                updateUserMissions(userMissions + 1);
                updateRankingDisplay();
            });
            
            // --- SISTEMA DE RANKING COM LOCALSTORAGE ---
            const defaultRankingData = [
                { name: 'Carlos S.', missions: 120, position: 1, initials: 'CS', id: 'carlos_s' },
                { name: 'Maria R.', missions: 95, position: 2, initials: 'MR', id: 'maria_r' },
                { name: 'Ana P.', missions: 87, position: 3, initials: 'AP', id: 'ana_p' },
                { name: 'João M.', missions: 73, position: 4, initials: 'JM', id: 'joao_m' },
                { name: 'João (Você)', missions: userMissions, position: userRanking, initials: 'JV', id: 'user' },
                { name: 'Pedro L.', missions: 45, position: 6, initials: 'PL', id: 'pedro_l' },
                { name: 'Sofia T.', missions: 38, position: 7, initials: 'ST', id: 'sofia_t' },
                { name: 'Lucas B.', missions: 29, position: 8, initials: 'LB', id: 'lucas_b' }
            ];

            let rankingData = loadFromStorage(STORAGE_KEYS.RANKING, {
                users: [...defaultRankingData],
                userMissions: userMissions,
                lastUpdate: new Date().toISOString()
            });

            // Atualizar missões do usuário
            userMissions = rankingData.userMissions;

            const saveRanking = () => {
                rankingData.userMissions = userMissions;
                rankingData.lastUpdate = new Date().toISOString();
                saveToStorage(STORAGE_KEYS.RANKING, rankingData);
            };

            const updateUserMissions = (newMissions) => {
                userMissions = newMissions;
                const userEntry = rankingData.users.find(user => user.id === 'user');
                if (userEntry) {
                    userEntry.missions = userMissions;
                }
                saveRanking();
            };

            // --- RANKING FUNCTIONS ---
            const updateRankingDisplay = () => {
                // Usar dados do localStorage
                const currentRanking = [...rankingData.users];
                
                // Atualizar missões do usuário
                const userEntry = currentRanking.find(user => user.id === 'user');
                if (userEntry) {
                    userEntry.missions = userMissions;
                }
                
                // Sort by missions count (descending)
                currentRanking.sort((a, b) => b.missions - a.missions);
                
                // Update positions
                currentRanking.forEach((user, index) => {
                    user.position = index + 1;
                });
                
                // Update user ranking
                const updatedUserEntry = currentRanking.find(user => user.id === 'user');
                userRanking = updatedUserEntry.position;
                
                // Salvar mudanças
                rankingData.users = currentRanking;
                saveRanking();
                
                // Update ranking preview on profile screen
                updateRankingPreview();
                
                // Update podium display
                const top3 = currentRanking.slice(0, 3);
                const podiumOrder = [top3[1], top3[0], top3[2]]; // 2nd, 1st, 3rd for visual ordering
                
                const getPodiumStyles = (position) => {
                    switch(position) {
                        case 1:
                            return {
                                avatar: 'w-20 h-20 bg-yellow-400 rounded-full flex items-center justify-center mb-2 border-4 border-yellow-500',
                                avatarText: 'text-2xl font-bold text-yellow-800',
                                platform: 'bg-yellow-400 w-24 h-20 rounded-t-lg flex items-center justify-center',
                                platformText: 'text-3xl font-bold text-yellow-800',
                                prize: 'mt-2 p-2 bg-yellow-100 rounded-lg text-center border-2 border-yellow-400',
                                prizeEmoji: '📱',
                                prizeTitle: 'iPhone',
                                prizeSubtitle: '15 Pro'
                            };
                        case 2:
                            return {
                                avatar: 'w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mb-2',
                                avatarText: 'text-2xl font-bold text-gray-600',
                                platform: 'bg-gray-300 w-20 h-16 rounded-t-lg flex items-center justify-center',
                                platformText: 'text-2xl font-bold text-white',
                                prize: 'mt-2 p-2 bg-gray-100 rounded-lg text-center',
                                prizeEmoji: '🎁',
                                prizeTitle: 'R$ 500',
                                prizeSubtitle: 'cupom'
                            };
                        case 3:
                            return {
                                avatar: 'w-16 h-16 bg-orange-200 rounded-full flex items-center justify-center mb-2',
                                avatarText: 'text-2xl font-bold text-orange-600',
                                platform: 'bg-orange-300 w-20 h-12 rounded-t-lg flex items-center justify-center',
                                platformText: 'text-2xl font-bold text-white',
                                prize: 'mt-2 p-2 bg-orange-100 rounded-lg text-center',
                                prizeEmoji: '🎫',
                                prizeTitle: '3 meses',
                                prizeSubtitle: 'grátis'
                            };
                    }
                };
                
                podiumContainer.innerHTML = podiumOrder.map(user => {
                    if (!user) return '';
                    const styles = getPodiumStyles(user.position);
                    return `
                        <div class="flex flex-col items-center">
                            <div class="${styles.avatar}">
                                <span class="${styles.avatarText}">${user.initials}</span>
                            </div>
                            <div class="${styles.platform}">
                                <span class="${styles.platformText}">${user.position}</span>
                            </div>
                            <p class="text-sm font-medium text-gray-800 mt-2">${user.name}</p>
                            <p class="text-xs text-gray-600">${user.missions} missões</p>
                            <div class="${styles.prize}">
                                <div class="text-lg">${styles.prizeEmoji}</div>
                                <p class="text-xs font-bold ${user.position === 1 ? 'text-yellow-800' : user.position === 2 ? 'text-gray-700' : 'text-orange-700'}">${styles.prizeTitle}</p>
                                <p class="text-xs ${user.position === 1 ? 'text-yellow-600' : user.position === 2 ? 'text-gray-500' : 'text-orange-500'}">${styles.prizeSubtitle}</p>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Update user position display
                userPosition.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center">
                                <span class="text-white font-bold">${userEntry.initials}</span>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">${userEntry.name}</p>
                                <p class="text-sm text-gray-600">${userEntry.missions} missões completadas</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-blue-600">#${userEntry.position}</div>
                            <p class="text-xs text-gray-500">posição</p>
                        </div>
                    </div>
                `;
                
                // Update full ranking list
                rankingList.innerHTML = currentRanking.map(user => {
                    const isUser = user.name === 'João (Você)';
                    const bgColor = isUser ? 'bg-blue-50' : 'bg-white';
                    const textColor = isUser ? 'text-blue-600' : 'text-gray-800';
                    
                    return `
                        <div class="flex items-center justify-between p-4 ${bgColor}">
                            <div class="flex items-center space-x-4">
                                <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-sm font-bold">
                                    ${user.position}
                                </div>
                                <div class="w-10 h-10 ${isUser ? 'bg-blue-500' : 'bg-gray-300'} rounded-full flex items-center justify-center">
                                    <span class="${isUser ? 'text-white' : 'text-gray-600'} text-sm font-bold">${user.initials}</span>
                                </div>
                                <div>
                                    <p class="font-medium ${textColor}">${user.name}</p>
                                    <p class="text-sm text-gray-500">${user.missions} missões</p>
                                </div>
                            </div>
                            ${user.position <= 3 ? `<div class="text-2xl">${user.position === 1 ? '🥇' : user.position === 2 ? '🥈' : '🥉'}</div>` : ''}
                        </div>
                    `;
                }).join('');
            };
            
            // Inicializa a tela
            console.log('🚀 Inicializando aplicação Pagaleve com localStorage...');
            console.log('📊 Estado inicial carregado:', {
                isSubscribed,
                cashbackBalance: cashbackBalanceAmount,
                userMissions,
                availableCoupons: getAvailableCoupons().length
            });
            
            renderMedals();
            updateCashbackBalance();
            updateSubscriptionUI();
            
            console.log('✅ Aplicação inicializada com sucesso!');
        });
    </script>

</body>
</html>
